##############################################
#Applied Spatial Statistics and Econometrics: Data Analysis in R (Routledge, 2020) 
#Przestrzenne metody ilościowe w R: statystyka, ekonometria, uczenie maszynowe, analiza danych (CeDeWu, 2020)
#Editor: Katarzyna Kopczewska 
#Authors: Katarzyna Kopczewska, Maria Kubara, Piotr Ćwiakowski, Mateusz Kopyt, Piotr Wójcik, Alessandro Festi, Kateryna Zabarina
#This book is a part of project supported by the Polish National Science Center (NCN) on „Spatial econometric models with fixed and changing neighborhood structure. Application for real estate valuation and business location” (OPUS 12, contract no. UMO-2016/23/B/ HS4/02363).
#All sample data used in the book and the codes presented in the content of the book were placed on https://github.com/kkopczewska/spatial_book 
##############################################

#Appendix A
#Datasets used in examples

library(spdep)
library(rgdal)
library(maptools)
library(sp)

setwd("D:/SpatialBook")

#A1. Data set No. 1 / dataset1 / - poviat panel data with many variables

data<-read.table("data_nts4_2019.csv", sep=";", dec=",", header=TRUE)
summary(data)                                                              
names(data)
dim(data)

#A2. Dataset no 2 /dataset2/ – geo-located point data 

firms<-read.csv("geoloc_data_firms.csv", header=TRUE, dec=",", sep=";")
summary(firms)                                 
names(firms)
dim(firms)

#A3. Dataset no 3 /dataset3/ – monthly unemployment rate in poviats (NTS4)
	
unemp<-read.csv("unemp2018.csv", header=TRUE, dec=",", sep=";")
summary(unemp)
names(unemp)
dim(unemp)

#A4. Dataset no 4 /dataset4/ - grid data for population

# loading grid for population and converting projections
pop<-readOGR(".", "PD_STAT_GRID_CELL_2011")
pop<-spTransform(pop, CRS("+proj=longlat +datum=NAD83"))

pop.df<-as.data.frame(pop) # extracting data to data.frame
head(pop.df)

# extracting grid
pop.grid<-as(pop, "SpatialPolygons")

# conversion to numerical data of subsequent columns of the data set
for(i in 1:15){
pop.df[,i]<-as.numeric(levels(pop.df[, i]))[pop.df[,1]]}

# cutting the grid to the contour of Warsaw, using contour from A5
pow.waw<-pov[pov@data$jpt_nazwa_=="powiat Warszawa",] # contour of Warsaw
lim<-over(pop.grid, pow.waw) # overlay of the grid and contour map
a<-which(lim$jpt_nazwa_=="Warsaw poviat") # lines matching the condition

# conditional grid and data.frame limitation to the selected area
pop.grid.waw<-pop.grid[lim$jpt_nazwa_=="powiat Warszawa",]
pop.df.waw<-pop.df[a,]

# figure - administrative borders and grid, Fig.A1a
plot(pop.grid.waw)
plot(pow.waw, add=TRUE)

# figure - values of the examined variable, Fig.A1b
library(GISTools)
choropleth(pop.grid.waw, pop.df.waw$TOT)
plot(pow.waw, add=TRUE)

#A5. Shapefiles of countour maps – for poviats (NTS4), regions (NTS2), country (NTS0) and registration areas

# map for poviats
pov<-readOGR(".", "powiaty") 
pov<- spTransform(pov, CRS("+proj=longlat +datum=NAD83"))
plot(pov)

# map for regions
voi<-readOGR(".", "wojewodztwa")
voi<- spTransform(voi, CRS("+proj=longlat +datum=NAD83"))
plot(voi)

# map for country
pl<-readOGR(".", "Panstwo")
pl<- spTransform(pl, CRS("+proj=longlat +datum=NAD83"))
plot(pl)

# map for registration areas
obreby<-st_read("dane/areas_registration.shp")
obreby %>% filter(str_detect(kod_obrebu, "1465")) %>% ggplot() + geom_sf() + theme_classic()

#A6. Raster data on night light intensity on Earth in 2013

dane_raster<-raster("F182013.v4c_web.stable_lights.avg_vis_PART.tif")

#A7. Population in cities in Poland

# loading prepared data
populationxy<-read.table("populationxy.csv", sep=";", dec=".",header=TRUE)
populationxy
